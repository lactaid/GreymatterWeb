<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History</title>
    <!-- Datepicker CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>

    <link rel="stylesheet" href="/bootstrap/bstyle.css" crossorigin="anonymous">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="d-flex">

    <div class="cover-container d-flex w-100 h-100 p-3 flex-column">
        <header class="mb-auto mx-3">
            <div>
                <h3 class="float-md-start mb-0"><img src="/img/SmithsLogo.png" width="130">
                </h3>
                <nav class="nav nav-masthead justify-content-center float-md-end nav-underline">
                    <a class="nav-link" href="/">Home</a>
                    <a class="nav-link" href="/production">Production</a>
                    <a class="nav-link" href="/notifications">Notifications</a>
                    <a class="nav-link" href="/repair">Repair</a>
                </nav>
            </div>
        </header>


        <div class="container mt-5">
            <div class="row" style="justify-content: center; text-align: center;">
                <div class="col-md-3" style="width: fit-content;">
                    <h2 class="card-title mt-3">
                        History
                    </h2>
                </div>
            </div>

            <hr style="padding: 1px; background-color: black; opacity: 1;">

            <div class="row align-items-start">
                <div class="card my-3 p-3 p-card col-3">
                    <form action="/repair_history" method="POST">
                        <div class="form-group">
                            <label for="campo1">Machine:</label>
                            <input type="text" class="form-control" id="campo1" name="campo1">
                        </div>
                        <div class="form-group">
                            <label for="campo2">From:</label>
                            <input type="text" class="form-control datepicker" id="campo2" name="campo2" placeholder="Selecciona una fecha">
                            <label for="campo3">To:</label>
                            <input type="text" class="form-control datepicker" id="campo3" name="campo3" placeholder="Selecciona una fecha">
                        </div>
                        <button type="submit" class="btn btn-primary" style="margin-top: 10px;">Search</button>
                    </form>
                </div>


                <div class="col" style="margin-top: 17px;">
                    <% if (results.length > 0) { %>


                        <div class="col-md-12">
                            <table class="table-sm table-bordered" style="text-align: center">
                                <thead>
                                    <tr>
                                        <th style="width: 50px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">Error Instance</th>
                                        <th style="width: 50px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">Finished Time</th>
                                        <th style="width: 50px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">Fault Mode</th>
                                        <th style="width: 50px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">Technician</th>
                                        <th style="width: 50px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">Comment</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% results.forEach(function(item) { %>
                                    
                                    <tr>
                                        <td style="width: 170px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                                            <%= item.ErrorInstance %>
                                        </td>
                                        <td data-bs-toggle="tooltip" title="<%= item.Finished_time %>">
                                            <div style="width: 170px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                                                <%= item.Finished_time %>
                                            </div>
                                        </td>
                                        <td style="width: 170px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                                            <%= item.Faultmode %>
                                        </td>
                                        <td style="width: 170px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                                            <%= item.name %> <%= item.lastname %>
                                        </td>
                                        <td data-bs-toggle="tooltip" title="<%= item.comment %>">
                                            <div style="width: 170px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                                                <%= item.comment %>
                                            </div>
                                        </td>
                                        
                                    </tr>
                                    <% }); %>
        
                                </tbody>
                            </table>
                        </div>
        
        
                    <% } else { %>
                        <div class="col-md-12">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Error Instance</th>
                                        <th>Finished Time</th>
                                        <th>Fault Mode</th>
                                        <th>Technician</th>
                                        <th>Comment</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    
                                    
                                    <tr>
                                        <td>
                                            ----
                                        </td>
                                        <td>
                                            ----
                                        </td>
                                        <td>
                                            ----
                                        </td>
                                        <td>
                                            ----
                                        </td>
                                        <td>
                                            ----
                                        </td>
                                        
                                    </tr>
        
                                </tbody>
                            </table>
                        </div>
                    <% } %>
                </div>

            </div>
            

        </div>

        
    </div>



    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

     <!-- Datepicker JS -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

  

    <script>
        $(document).ready(function(){
            $('.datepicker').datepicker({
                format: 'yyyy-mm-dd',
                autoclose: true,
                todayHighlight: true
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
</body>
</html>
